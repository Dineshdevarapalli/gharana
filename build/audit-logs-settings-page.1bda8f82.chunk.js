"use strict";(self.webpackChunkart_gharana_api=self.webpackChunkart_gharana_api||[]).push([[2812],{49687:(K,D,a)=>{a.d(D,{Z:()=>T});var e=a(62369),o=a(16495),S=a(25794);function T(t,n){var s;(0,o.Z)(1,arguments);var r=(0,S.Z)((s=n?.additionalDigits)!==null&&s!==void 0?s:2);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var l=h(t),v;if(l.date){var P=B(l.date,r);v=M(P.restDateString,P.year)}if(!v||isNaN(v.getTime()))return new Date(NaN);var Z=v.getTime(),I=0,N;if(l.time&&(I=A(l.time),isNaN(I)))return new Date(NaN);if(l.timezone){if(N=W(l.timezone),isNaN(N))return new Date(NaN)}else{var O=new Date(Z+I),$=new Date(0);return $.setFullYear(O.getUTCFullYear(),O.getUTCMonth(),O.getUTCDate()),$.setHours(O.getUTCHours(),O.getUTCMinutes(),O.getUTCSeconds(),O.getUTCMilliseconds()),$}return new Date(Z+I+N)}var y={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},U=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,E=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,F=/^([+-])(\d{2})(?::?(\d{2}))?$/;function h(t){var n={},s=t.split(y.dateTimeDelimiter),r;if(s.length>2)return n;if(/:/.test(s[0])?r=s[0]:(n.date=s[0],r=s[1],y.timeZoneDelimiter.test(n.date)&&(n.date=t.split(y.timeZoneDelimiter)[0],r=t.substr(n.date.length,t.length))),r){var l=y.timezone.exec(r);l?(n.time=r.replace(l[1],""),n.timezone=l[1]):n.time=r}return n}function B(t,n){var s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+n)+"})|(\\d{2}|[+-]\\d{"+(2+n)+"})$)"),r=t.match(s);if(!r)return{year:NaN,restDateString:""};var l=r[1]?parseInt(r[1]):null,v=r[2]?parseInt(r[2]):null;return{year:v===null?l:v*100,restDateString:t.slice((r[1]||r[2]).length)}}function M(t,n){if(n===null)return new Date(NaN);var s=t.match(U);if(!s)return new Date(NaN);var r=!!s[4],l=C(s[1]),v=C(s[2])-1,P=C(s[3]),Z=C(s[4]),I=C(s[5])-1;if(r)return G(n,Z,I)?V(n,Z,I):new Date(NaN);var N=new Date(0);return!w(n,v,P)||!X(n,l)?new Date(NaN):(N.setUTCFullYear(n,v,Math.max(l,P)),N)}function C(t){return t?parseInt(t):1}function A(t){var n=t.match(E);if(!n)return NaN;var s=R(n[1]),r=R(n[2]),l=R(n[3]);return k(s,r,l)?s*e.vh+r*e.yJ+l*1e3:NaN}function R(t){return t&&parseFloat(t.replace(",","."))||0}function W(t){if(t==="Z")return 0;var n=t.match(F);if(!n)return 0;var s=n[1]==="+"?-1:1,r=parseInt(n[2]),l=n[3]&&parseInt(n[3])||0;return q(r,l)?s*(r*e.vh+l*e.yJ):NaN}function V(t,n,s){var r=new Date(0);r.setUTCFullYear(t,0,4);var l=r.getUTCDay()||7,v=(n-1)*7+s+1-l;return r.setUTCDate(r.getUTCDate()+v),r}var Y=[31,null,31,30,31,30,31,31,30,31,30,31];function z(t){return t%400===0||t%4===0&&t%100!==0}function w(t,n,s){return n>=0&&n<=11&&s>=1&&s<=(Y[n]||(z(t)?29:28))}function X(t,n){return n>=1&&n<=(z(t)?366:365)}function G(t,n,s){return n>=1&&n<=53&&s>=0&&s<=6}function k(t,n,s){return t===24?n===0&&s===0:s>=0&&s<60&&n>=0&&n<60&&t>=0&&t<25}function q(t,n){return n>=0&&n<=59}},50935:(K,D,a)=>{a.d(D,{R:()=>S});var e=a(52358),o=a(88767);function S(T={},y={}){const{id:U="",...E}=T,{get:F}=(0,e.kY)(),{data:h,isError:B,isLoading:M,refetch:C}=(0,o.useQuery)(["users",U,E],async()=>{const{data:{data:R}}=await F(`/admin/users/${U}`,{params:E});return R},y);let A=[];return U&&h?A=[h]:Array.isArray(h?.results)&&(A=h.results),{users:A,pagination:h?.pagination??null,isLoading:M,isError:B,refetch:C}}},94699:(K,D,a)=>{a.d(D,{Z:()=>B});var e=a(67294),o=a(41580),S=a(29728),T=a(52358),y=a(89597),U=a(45697),E=a.n(U),F=a(86896);const h=({displayedFilters:M})=>{const[C,A]=(0,e.useState)(!1),{formatMessage:R}=(0,F.Z)(),W=(0,e.useRef)(),V=()=>{A(Y=>!Y)};return e.createElement(e.Fragment,null,e.createElement(o.x,{paddingTop:1,paddingBottom:1},e.createElement(S.z,{variant:"tertiary",ref:W,startIcon:e.createElement(y.Z,null),onClick:V,size:"S"},R({id:"app.utils.filters",defaultMessage:"Filters"})),C&&e.createElement(T.J5,{displayedFilters:M,isVisible:C,onToggle:V,source:W})),e.createElement(T.W$,{filtersSchema:M}))};h.propTypes={displayedFilters:E().arrayOf(E().shape({name:E().string.isRequired,metadatas:E().shape({label:E().string}),fieldSchema:E().shape({type:E().string})})).isRequired};const B=h},35915:(K,D,a)=>{a.r(D),a.d(D,{default:()=>De});var e=a(67294),o=a(52358),S=a(86706),T=a(99369),y=a(17034),U=a(49066),E=a(41580),F=a(185),h=a(53979),B=a(36989),M=a(86896),C=a(94699),A=a(88767),R=a(16550),W=a(50935);const Y=({canReadAuditLogs:i,canReadUsers:g})=>{const{get:f}=(0,o.kY)(),{search:u}=(0,R.TH)(),p=(0,o.lm)(),[{query:c}]=(0,o.Kx)(),d={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:b=>p({type:"warning",message:b.message})},{users:m,isError:L,isLoading:x}=(0,W.R)({},{...d,enabled:g,staleTime:2*(1e3*60)}),{data:j,isLoading:J,isError:Q}=(0,A.useQuery)(["auditLogs",u],async()=>{const{data:b}=await f("/admin/audit-logs",{params:c});return b},{...d,enabled:i});return{auditLogs:j,users:m,isLoading:x||J,hasError:Q||L}};var z=a(42866),w=a(24969),X=a(59946),G=a(63321),k=a(36773),q=a(45697),t=a.n(q),n=a(49687);const r=()=>{const{formatDate:i}=(0,M.Z)();return f=>{const u=(0,n.Z)(f),p=i(u,{dateStyle:"long"}),c=i(u,{timeStyle:"medium",hourCycle:"h24"});return`${p}, ${c}`}};var l=a(11047),v=a(77197),P=a(75515),Z=a(11276),I=a(39990);const N={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},O=i=>N[i]||i,$=({actionLabel:i,actionName:g})=>e.createElement(l.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(P.Z,{textColor:"neutral600",variant:"sigma"},i),e.createElement(P.Z,{textColor:"neutral600"},g));$.propTypes={actionLabel:t().string.isRequired,actionName:t().string.isRequired};const H=$,_=({status:i,data:g,formattedDate:f})=>{const{formatMessage:u}=(0,M.Z)();if(i==="loading")return e.createElement(l.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(v.a,null,"Loading content..."));const{action:p,user:c,payload:d}=g;return e.createElement(e.Fragment,null,e.createElement(E.x,{marginBottom:3},e.createElement(P.Z,{variant:"delta",id:"title"},u({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(Z.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(H,{actionLabel:u({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:u({id:`Settings.permissions.auditLogs.${p}`,defaultMessage:O(p)},{model:d?.model})}),e.createElement(H,{actionLabel:u({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:f}),e.createElement(H,{actionLabel:u({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:c?.displayName||"-"}),e.createElement(H,{actionLabel:u({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:c?.id.toString()||"-"})),e.createElement(I.V,{value:JSON.stringify(d,null,2),disabled:!0,label:u({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};_.defaultProps={data:{}},_.propTypes={status:t().oneOf(["idle","loading","error","success"]).isRequired,data:t().shape({action:t().string,date:t().string,payload:t().object,user:t().object}),formattedDate:t().string.isRequired};const oe=_,ne=({handleClose:i,logId:g})=>{const{get:f}=(0,o.kY)(),u=(0,o.lm)(),p=async x=>{const{data:j}=await f(`/admin/audit-logs/${x}`);if(!j)throw new Error("Audit log not found");return j},{data:c,status:d}=(0,A.useQuery)(["audit-log",g],()=>p(g),{onError(){u({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),i()}}),m=r(),L=c?m(c.date):"";return e.createElement(z.P,{onClose:i,labelledBy:"title"},e.createElement(w.x,null,e.createElement(G.O,{label:L,id:"title"},e.createElement(k.$,{isCurrent:!0},L))),e.createElement(X.f,null,e.createElement(oe,{status:d,data:c,formattedDate:L})))};ne.propTypes={handleClose:t().func.isRequired,logId:t().string.isRequired};const le=ne,ee=({pagination:i})=>e.createElement(E.x,{paddingTop:4},e.createElement(l.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(o.v4,null),e.createElement(o.tU,{pagination:i})));ee.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},ee.propTypes={pagination:t().shape({page:t().number,pageCount:t().number,pageSize:t().number,total:t().number})};const de=ee;var ue=a(15234),me=a(79031),se=a(37909),ce=a(12028),ge=a(8934);const te=({headers:i,rows:g,onOpenModal:f})=>{const{formatMessage:u}=(0,M.Z)(),p=r(),c=({type:d,value:m,model:L})=>d==="date"?p(m):d==="action"?u({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:O(m)},{model:L}):m||"-";return e.createElement(ue.p,null,g.map(d=>e.createElement(me.Tr,{key:d.id,...(0,o.X7)({fn:()=>f(d.id)})},i.map(({key:m,name:L,cellFormatter:x})=>e.createElement(se.Td,{key:m},e.createElement(P.Z,{textColor:"neutral800"},c({type:m,value:x?x(d[L]):d[L],model:d.payload?.model})))),e.createElement(se.Td,{...o.UW},e.createElement(l.k,{justifyContent:"end"},e.createElement(ce.h,{onClick:()=>f(d.id),"aria-label":u({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${d.action} action`}),noBorder:!0,icon:e.createElement(ge.Z,null)}))))))};te.defaultProps={rows:[]},te.propTypes={headers:t().array.isRequired,rows:t().array,onOpenModal:t().func.isRequired};const pe=te;var fe=a(29178),Ee=a(90608);const ae=({value:i,options:g,onChange:f})=>{const{formatMessage:u}=(0,M.Z)(),p=u({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(fe.hQ,{"aria-label":p,value:i,onChange:f},g.map(({label:c,customValue:d})=>e.createElement(Ee.O,{key:d,value:d},c)))};ae.defaultProps={value:null},ae.propTypes={value:t().string,options:t().arrayOf(t().shape({label:t().string.isRequired,customValue:t().string.isRequired}).isRequired).isRequired,onChange:t().func.isRequired};const re=ae,ie=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],ve=({formatMessage:i,users:g,canReadUsers:f})=>{const u=Object.keys(N).map(c=>({label:i({id:`Settings.permissions.auditLogs.${c}`,defaultMessage:O(c)},{model:void 0}),customValue:c})),p=[{name:"action",metadatas:{customOperators:ie,label:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:u,customInput:re},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(f&&g){const c=m=>m.username?m.username:m.firstname&&m.lastname?i({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:m.firstname,lastname:m.lastname}):m.email,d=g.map(m=>({label:c(m),customValue:m.id.toString()}));return[...p,{name:"user",metadatas:{customOperators:ie,label:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:d,customInput:re},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return p},ye=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:i=>i?i.displayName:""}],Le=()=>{const{formatMessage:i}=(0,M.Z)(),g=(0,S.v9)(T._),{allowedActions:{canRead:f,canReadUsers:u}}=(0,o.ss)({...g.settings.auditLogs,readUsers:g.settings.users.read}),[{query:p},c]=(0,o.Kx)(),{auditLogs:d,users:m,isLoading:L,hasError:x}=Y({canReadAuditLogs:f,canReadUsers:u});(0,o.go)();const j=ve({formatMessage:i,users:m,canReadUsers:u}),J=i({id:"global.auditLogs",defaultMessage:"Audit Logs"}),Q=ye.map(b=>({...b,metadatas:{...b.metadatas,label:i(b.metadatas.label)}}));return x?e.createElement(y.A,null,e.createElement(U.D,null,e.createElement(E.x,{paddingTop:8},e.createElement(o.Hn,null)))):e.createElement(F.o,{"aria-busy":L},e.createElement(o.SL,{name:J}),e.createElement(h.T,{title:J,subtitle:i({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(B.Z,{startActions:e.createElement(C.Z,{displayedFilters:j})}),e.createElement(U.D,{canRead:f},e.createElement(o.tM,{contentType:"Audit logs",headers:Q,rows:d?.results||[],withBulkActions:!0,isLoading:L},e.createElement(pe,{headers:Q,rows:d?.results||[],onOpenModal:b=>c({id:b})})),e.createElement(de,{pagination:d?.pagination})),p?.id&&e.createElement(le,{handleClose:()=>c({id:null},"remove"),logId:p.id}))},De=()=>{const i=(0,S.v9)(T._);return e.createElement(o.O4,{permissions:i.settings.auditLogs.main},e.createElement(Le,null))}},90608:(K,D,a)=>{a.d(D,{O:()=>o});var e=a(29178);const o=e.Wx},36989:(K,D,a)=>{a.d(D,{Z:()=>S});var e=a(85893),o=a(11047);const S=({startActions:T,endActions:y})=>!T&&!y?null:(0,e.jsxs)(o.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(o.k,{gap:2,wrap:"wrap",children:T}),(0,e.jsx)(o.k,{gap:2,shrink:0,wrap:"wrap",children:y})]})}}]);
